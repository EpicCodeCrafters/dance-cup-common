name: Notify

on:
  workflow_dispatch:

jobs:
  loop-job:
    runs-on: ubuntu-latest
    env:
      NOTIFIER_ENABLED: ${{ secrets.NOTIFIER_ENABLED }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Запуск работы
        run: echo "Начало работы"
      
      - name: Ожидание
        run: sleep 3600  # Ждём 1 час (3600 секунд)

      - name: Notify
        if: ${{ env.NOTIFIER_ENABLED == 'true' }}
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.ECC_TG_CHAT_ID }}
        run: |
          MESSAGE="@SenchinYB Привет\\! Какой статус по задачам?"
          curl -s -X POST https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage \
            -d chat_id=$TELEGRAM_CHAT_ID \
            -d text="$MESSAGE" \
            -d parse_mode=MarkdownV2

      - name: Повторный запуск
        run: gh workflow run github-notifier.yml
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
