name: Notify

on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:

jobs:
  loop-job:
    runs-on: ubuntu-latest
    env:
      NOTIFIER_ENABLED: ${{ secrets.NOTIFIER_ENABLED }}  # Включение/выключение через секрет
    steps:
      - name: Выбор случайного сообщения и отправка уведомления
        if: ${{ env.NOTIFIER_ENABLED == 'true' }}
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.ECC_TG_CHAT_ID }}
        run: |
          MESSAGES=(
            "@SenchinYB\\, йоу\\, если от твоего апдейта зависят мои последние нейроны\\, то я уже обречен\\!"
            "Эгегей\\, @SenchinYB\\, если я не получу статус через 5 минут\\, твой код отправят на ревью Илону Маску\\!"
            "Привет\\, @SenchinYB\\! Это не вопрос\\, это ультиматум: отвечаешь сейчас или твой монитор подхватит синий экран смерти\\!"
            "Эй\\, @SenchinYB\\, твой дедлайн уже настолько стар\\, что его внесли в список археологических находок\\!"
            "Здарова\\, @SenchinYB\\! Напоминаю\\, что твое молчание заставляет меня перечитывать твой код как захватывающий триллер с плохим концом\\!"
            "@SenchinYB\\, братан\\, если ты это читаешь – у тебя есть 10 секунд до того\\, как я начну коммитить в мастер от твоего имени\\!"
            "@SenchinYB\\, камон\\, давай по чесноку – задачи готовы или я начинаю рассылку твоих старых коммитов с комментариями 'я бог'\\?"
            "@SenchinYB\\, если ты сейчас не ответишь\\, я закажу тебе ананасовую пиццу с двойным сыром и отправлю её коллегам как 'подарок от SenchinYB'\\!"
            "Слушай\\, @SenchinYB\\, если ты мне не дашь апдейт\\, я начну писать документацию в стиле 'и так сойдет'\\!"
            "Аууу\\, @SenchinYB\\, твое молчание звенит громче\\, чем ошибки в продакшене после твоего последнего деплоя\\!"
            "Ты либо даёшь апдейт\\, либо я объявляю тебя в федеральный розыск с пометкой 'опасен для дедлайнов'\\!"
            "Внимание\\, @SenchinYB\\, твои задачи превысили дедлайн настолько\\, что у них началась своя эра летоисчисления\\!"
            "@SenchinYB\\, если я не получу ответ\\, твой следующий кофе будет с солью вместо сахара\\. Карма – не бумеранг\\, а бариста по моему звонку\\!"
            "Эй\\, @SenchinYB\\, доброе утро\\! Напоминаю\\, что твое молчание – это идеальный саундтрек для моего спуска в безумие\\!"
            "Привет\\, @SenchinYB\\! Что по статусу\\? Если ответа нет\\, я начну ставить лайки под твоими старыми фото в соцсетях от имени твоей бабушки\\!"
            "@SenchinYB\\, ты уже доделал\\? Или мне начать писать завещание\\, где виновником указано 'невыполненное ТЗ'\\?"
            "Здарова\\, @SenchinYB\\! Я тут подумал… А не пора ли мне услышать апдейт или начать rehearsing для твоего панихида по карьере\\?"
            "@SenchinYB\\, братан\\, если ты это читаешь – твой коммит-история скоро станет мемом в канале 'программистский позор'\\!"
            "@SenchinYB\\, камон\\, давай по чесноку – задачи готовы или я запускаю скрипт\\, который заменяет все твои табы на пробелы\\?"
            "@SenchinYB\\, если ты сейчас не ответишь\\, я закажу тебе не только пиццу\\, но и суши с кетчупом – вот тогда ты узнаешь настоящую боль\\!"
            "Слушай\\, @SenchinYB\\, если ты мне не дашь апдейт\\, я начну кодить с глобальными переменными и назову это 'микросервисной архитектурой'\\!"
            "Аууу\\, @SenchinYB\\, ты где\\? Твой дедлайн плачет в углу\\, а я уже начал делать ему искусственное дыхание\\!"
            "Ты либо даёшь апдейт\\, либо я публикую твое резюме с навыком 'эксперт по прокрастинации' на Хабр Карьере\\!"
            "Внимание\\, @SenchinYB\\, твои задачи превысили дедлайн\\, и теперь они требуют политического убежища в другом проекте\\!"
          )
          
          # Выбор случайного сообщения
          RANDOM_INDEX=$((RANDOM % ${#MESSAGES[@]}))
          MESSAGE=${MESSAGES[$RANDOM_INDEX]}

          # Проверка на пустое сообщение
          if [ -z "$MESSAGE" ]; then
            echo "Ошибка: Пустое сообщение, отправка отменена."
            exit 1
          fi

          # Отправка сообщения через Telegram API
          curl -s -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \
            -d chat_id="$TELEGRAM_CHAT_ID" \
            -d text="$MESSAGE" \
            -d parse_mode="MarkdownV2" || echo "Ошибка отправки в Telegram: $MESSAGE"
